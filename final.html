<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<title>Tarjeta Final</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { background:black; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:sans-serif; color:white; height:100vh; }
canvas { background:none; }
button { margin:0.5rem; padding:0.5rem 1rem; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
#shareBtn { background:#e1306c; color:white; }
#downloadBtn { background:gold; color:black; }
</style>
</head>
<body>
  <canvas id="cardcanvas" width="492" height="764"></canvas>
  <button id="shareBtn" onclick="shareStory()">Compartir en Instagram</button>
  <button id="downloadBtn" onclick="downloadCard()">Descargar</button>
  <script>
    window.onload = function() {
      const cv = document.getElementById('cardcanvas');
      const ctx = cv.getContext('2d');
      const bg = new Image(); bg.src = 'card_panam_bg_v2.png';
      bg.onload = () => {
        ctx.drawImage(bg, 0, 0, cv.width, cv.height);
        const avatar = new Image(); avatar.src = localStorage.getItem('foto');
        avatar.onload = () => {
          ctx.drawImage(avatar, 123, 91, 246, 214);
          ctx.fillStyle = 'white';
          ctx.font = 'bold 32px sans-serif';
          ctx.textAlign = 'right';
          ctx.fillText('FRZ', 172, 443);
          ctx.fillText('VEL', 172, 520);
          ctx.fillText('RES', 172, 596);
          ctx.textAlign = 'left';
          ctx.fillText(localStorage.getItem('d1'), 320, 443);
          ctx.fillText(localStorage.getItem('d2'), 320, 520);
          ctx.fillText(localStorage.getItem('d3'), 320, 596);
        };
      };
    };
    function shareStory() {
      html2canvas(document.getElementById('cardcanvas')).then(canvas => {
        canvas.toBlob(blob => {
          const reader = new FileReader();
          reader.onload = () => {
            window.location.href = 'instagram://story-camera?background_image=' + encodeURIComponent(reader.result);
          };
          reader.readAsDataURL(blob);
        });
      });
    }
    function downloadCard() {
      html2canvas(document.getElementById('cardcanvas')).then(canvas => {
        const a = document.createElement('a');
        a.download = 'tarjeta.png';
        a.href = canvas.toDataURL();
        a.click();
      });
    }
  </script>
</body>
</html>